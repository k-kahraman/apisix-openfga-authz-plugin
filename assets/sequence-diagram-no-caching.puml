@startuml APISIX OpenFGA Plugin Sequence Diagram w/o Caching
!theme plain
actor Client
participant "Apache APISIX" as APISIX
participant "OpenFGA Plugin" as Plugin
participant "OpenFGA" as OpenFGA
database "Backend Service" as Backend

Client -> APISIX: API Request
activate APISIX

APISIX -> Plugin: Intercept Request
activate Plugin

Plugin -> Plugin: Extract Resource & Relation

Plugin -> OpenFGA: Check Authorization
activate OpenFGA
OpenFGA --> Plugin: Authorization Decision
deactivate OpenFGA

alt is authorized
    Plugin --> APISIX: Allow Request
    APISIX -> Backend: Forward Request
    Backend --> APISIX: Response
    APISIX --> Client: API Response
else is not authorized
    Plugin --> APISIX: Deny Request
    APISIX --> Client: 403 Forbidden
end

deactivate Plugin
deactivate APISIX
@enduml